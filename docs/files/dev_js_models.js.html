<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>dev\js\models.js - posty-soft.org</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="posty-soft.org"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 2.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/AlertCtrl.html">AlertCtrl</a></li>
            
                <li><a href="../classes/AlertService.html">AlertService</a></li>
            
                <li><a href="../classes/ApiKeyCtrl.html">ApiKeyCtrl</a></li>
            
                <li><a href="../classes/ApiKeys.html">ApiKeys</a></li>
            
                <li><a href="../classes/DashboardCtrl.html">DashboardCtrl</a></li>
            
                <li><a href="../classes/DomainAliasses.html">DomainAliasses</a></li>
            
                <li><a href="../classes/DomainCtrl.html">DomainCtrl</a></li>
            
                <li><a href="../classes/DomainData.html">DomainData</a></li>
            
                <li><a href="../classes/Domains.html">Domains</a></li>
            
                <li><a href="../classes/ErrorCtrl.html">ErrorCtrl</a></li>
            
                <li><a href="../classes/MainCtrl.html">MainCtrl</a></li>
            
                <li><a href="../classes/NavBarCtrl.html">NavBarCtrl</a></li>
            
                <li><a href="../classes/Page.html">Page</a></li>
            
                <li><a href="../classes/ProcessCtrl.html">ProcessCtrl</a></li>
            
                <li><a href="../classes/ProcessService.html">ProcessService</a></li>
            
                <li><a href="../classes/ProcessServiceProvider.html">ProcessServiceProvider</a></li>
            
                <li><a href="../classes/ResponseHandler.html">ResponseHandler</a></li>
            
                <li><a href="../classes/Servers.html">Servers</a></li>
            
                <li><a href="../classes/Summaries.html">Summaries</a></li>
            
                <li><a href="../classes/SummaryCtrl.html">SummaryCtrl</a></li>
            
                <li><a href="../classes/TransportCtrl.html">TransportCtrl</a></li>
            
                <li><a href="../classes/Transports.html">Transports</a></li>
            
                <li><a href="../classes/UserAliasCtrl.html">UserAliasCtrl</a></li>
            
                <li><a href="../classes/UserAliasses.html">UserAliasses</a></li>
            
                <li><a href="../classes/UserCtrl.html">UserCtrl</a></li>
            
                <li><a href="../classes/UserData.html">UserData</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: dev\js\models.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/*!
 * posty_webUI
 *
 * Copyright 2014 posty-soft.org
 * Licensed under the LGPL v3
 * https://www.gnu.org/licenses/lgpl.html
 *
 */
define([&#x27;angular&#x27;, &#x27;restangular&#x27;], function (angular, Restangular) {
	&#x27;use strict&#x27;;

	var app = angular.module(&#x27;postySoft.models&#x27;, [&#x27;postySoft.services&#x27;]);

	/**
	* filters the error-messages of the response and returns the concated messages
	*
	* @method  @return {String} Returns the error-message
	*/
	var errorMsg = function(response) {
		var result = &quot;&quot;;
		for(var prop in response) {			
		    if(response.hasOwnProperty(prop)) {
				result = result+&quot;. &quot;+response[prop];
		    }
		}
		return result.substr(2, result.length)+&quot;.&quot;;		
	};	

	/**
	* central domain-model. Here you do all the CRUD-operations with the REST-API
	*
	* @class Domains
	*/
	app.factory(&#x27;Domains&#x27;, [&#x27;Restangular&#x27;, &#x27;AlertService&#x27;, function(Restangular, AlertService) {
		var ALL_DOMAINS = {
			name: &quot;all Domains&quot;
		}; // const for the all-domain-selection

		var currentDomain = ALL_DOMAINS; // current Domain you have selected 	
		var list = []; // list of all domains		
		var realDataList = []; // list of all data before it is edited			
		var observerList = []; // observer for sitching the current-domain

		var notifyObservers = function() {
			for (var i = 0; i &lt; observerList.length; i++) {	
				observerList[i].update();
			}
		};

		var containsObserver = function(observer) {
			for (var i = 0; i &lt; observerList.length; i++) {		 						 		
		 		if (observerList[i].getName() === observer.getName()) {
		 			return true;		 			
		 		}				 						 		
	 		}
	 		return false;
		}

		var refresh = function() {
			list = [];			
			realDataList = [];
			var dao = Restangular.all(&#x27;domains&#x27;); 
			dao.getList().then(function(data) {									
			 	for (var i = 0; i &lt; data.length; i++) {	
			 		realDataList.push(angular.copy(data[i]));
			 		list.push(data[i].virtual_domain);			 		
			 	}													
			});		
		};	

		var oldDomainByID = function(id) {
		 	for (var i = 0; i &lt; realDataList.length; i++) {		 						 		
		 		if (realDataList[i].virtual_domain.id == id) {
		 			return realDataList[i].virtual_domain;
		 		}				 						 		
		 	}			
		};
	  
		return {
			ALL_DOMAINS: ALL_DOMAINS,
			/**
			* returns if the domain is valid or not
			*
			* @method isValid
			* @param domain {Object} the domain
			* @return {Boolean} Returns true if the domain is valid	
			*/			
			isValid: function(domain) {
				return (domain &amp;&amp; domain != ALL_DOMAINS);			
			},
			/**
			* returns if all domains are selected or not
			*
			* @method allDomainsSelected
			* @return {Boolean} Returns true if currentDomain == ALL_DOMAINS	
			*/		
			allDomainsSelected: function() { 
				return (currentDomain == ALL_DOMAINS); 
			},
			/**
			* returns the current domain
			*
			* @method currentDomain
			* @return {Object} Returns the current domain
			*/
			currentDomain: function() { 
				return currentDomain; 
			},
			/**
			* sets the current domain
			*
			* @method setCurrentDomain	
			* @param value {Object} the new current domain
			*/
			setCurrentDomain: function(value) { 				
				if (value != currentDomain) {
					currentDomain = value;									
					notifyObservers();							
				}		
			},
			/**
			* creates a new domain		
			*
			* @method createDomain		
			* @param domain {Object} the domain-object
			*/
			create: function(domain) {	
				var dao = Restangular.all(&#x27;domains&#x27;); 
				dao.post(domain).then(function(response) {	
					var msg = &quot;New domain created: &quot;+domain.name;
					AlertService.addAlert(&quot;success&quot;,msg);					
					currentDomain = ALL_DOMAINS;												
					refresh();						
				}, function(response) {	
					var msg = &quot;There was an error saving the domain &quot;+domain.name+&quot;: \n&quot;+errorMsg(response.data.error);
					AlertService.addAlert(&quot;danger&quot;,msg);					
				});			
			},
			/**
			* edit a existing domain
			*
			* @method edit		
			* @param domain {Object} the domain-object
			*/
			edit: function(domain) {
				var oldDomain = oldDomainByID(domain.id);
				var dao = Restangular.one(&#x27;domains&#x27;,oldDomain.name);
				dao.name = domain.name;
				dao.put().then(function(response) {
					var msg = &quot;Domain &quot;+domain.name+&quot; updated!&quot;;
					AlertService.addAlert(&quot;success&quot;,msg);
					refresh();
				}, function(response) {
					var msg = &quot;There was an error updating the domain &quot;+domain.name+&quot;: \n&quot;+errorMsg(response.data.error);
					AlertService.addAlert(&quot;danger&quot;,msg);
					refresh();
				});
			},
			/**
			* remove a existing domain
			*
			* @method removeDomain		
			* @param domain {Object} the domain-object
			*/
			remove: function(domain) {				
				var dao = Restangular.one(&#x27;domains&#x27;,domain.name);		
				dao.remove().then(function(response) {							
					var msg = &quot;Domain &quot;+domain.name+&quot; deleted!&quot;;
					AlertService.addAlert(&quot;success&quot;,msg);					
					if (domain == currentDomain)
						currentDomain = ALL_DOMAINS;	
					refresh();									
				}, function(response) {				
					var msg = &quot;There was an error deleting the domain &quot;+domain.name+&quot;: \n&quot;+errorMsg(response.data.error);
					AlertService.addAlert(&quot;danger&quot;,msg);					
				});				
			},						
			/**
			* get the list of all domains		
			*
			* @method getlist		
			* @return {Array} Returns the list-member
			*/
			getList: function() {				
				return list;	
			},
			/**
			* refreshes the List
			*
			* @method refreshList
			*/
			refresh: function() {
				refresh();
			},
			/**
			* register observers for the currentDomain change event
			*
			* @method registerCurrentDommainObserver
			* @param observer {Object} observer-Objecter with update-Method
			*/			
			registerCurrentDomainObserver: function(observer) {							
				if (!containsObserver(observer)) {
					observerList.push(observer);
				}												
			},
			/**
			* unregister observers for the currentDomain change event
			*
			* @method unregisterCurrentDommainObserver
			* @param observer {Object} observer-Objecter with update-Method
			*/			
			unregisterCurrentDomainObserver: function(observer) {
				var index = observerList.indexOf(observer);
				if (index &gt; -1) {
					observerList.splice(index, 1);
				}
			}
		};
	}]);

	/**
	* central DomainAliasses-model. Here you do all the CRUD-operations with the REST-API
	*
	* @class DomainAliasses
	*/
	app.factory(&#x27;DomainAliasses&#x27;, [&#x27;Restangular&#x27;, &#x27;AlertService&#x27;, &#x27;Domains&#x27;, function(Restangular, AlertService, Domains) {
		var list = [];	// list of all aliases

		var domain = null;	
		
		var refresh = function() {
			list = [];			
			if (Domains.isValid(domain)) {  												
				Restangular.one(&#x27;domains&#x27;,domain.name).all(&#x27;aliases&#x27;).getList().then(function(data) {										 	
				 	for (var i = 0; i &lt; data.length; i++) {				 					 		
				 		list.push(data[i].virtual_domain_alias);				 						 						 				 		
				 	}					 																		
				});				
			}			
		};	

		return {
            /**
             * set the domain
             *
             * @method setDomain
             * @param newDomain {Object} the domain object
             */
            setDomain: function(newDomain) {
				if (domain != newDomain) {
					domain = newDomain;
				}
			},
            /**
             * get the domain
             *
             * @method getDomain
             */
			getDomain: function () {
				return domain;
			},
			/**
			* creates an new domain-alias
			*
			* @method create
			* @param alias {Object} the alias object			
			*/			
			create: function(alias) {
				var dao = Restangular.one(&#x27;domains&#x27;,domain.name).all(&#x27;aliases&#x27;);				
				dao.post(alias).then(function(response) {	
					var msg = &quot;New domain alias created: &quot;+alias.name;
					AlertService.addAlert(&quot;success&quot;,msg);
					refresh();
				}, function(response) {	
					var msg = &quot;There was an error saving the domain alias &quot;+alias.name+&quot;: \n&quot;+errorMsg(response.data.error);
					AlertService.addAlert(&quot;danger&quot;,msg); 						
				});							
			},
			/**
			* remove an existing alias
			*
			* @method remove
			* @param alias {Object} the alias object			
			*/
			remove: function(alias) {													
				var dao = Restangular.one(&#x27;domains&#x27;,domain.name).one(&#x27;aliases&#x27;, alias.name);
				dao.remove().then(function(response) {							
					var msg = &quot;Domain alias &quot;+alias.name+&quot; deleted!&quot;;
					AlertService.addAlert(&quot;success&quot;,msg);					
					refresh();
				}, function(response) {
					var msg = &quot;There was an error deleting the domain alias &quot;+alias.name+&quot;: \n&quot;+errorMsg(response.data.error);
					AlertService.addAlert(&quot;danger&quot;,msg);					
				});		
			},
			/**
			* get the list of all aliases		
			*
			* @method getList		
			* @return {Array} Returns the list-member
			*/
			getList: function() {		
				return list;	
			},
			/**
			* refreshes the list
			*
			* @method refresh
			*/				
			refresh: function() {			
				refresh();
			}
		};
	}]);

    /**
     * central Transport-model. Here you do all the CRUD-operations with the REST-API
     *
     * @class Transports
     */
    app.factory(&#x27;Transports&#x27;, [&#x27;Restangular&#x27;, &#x27;AlertService&#x27;, function(Restangular, AlertService) {
        var list = [];	// list of all transports
        var realDataList = []; // list of all data before it is edited

        var refresh = function() {
            list = [];
            realDataList = [];
            Restangular.all(&#x27;transports&#x27;).getList().then(function(data) {
                for (var i = 0; i &lt; data.length; i++) {
                    realDataList.push(angular.copy(data[i]));
                    list.push(data[i].virtual_transport);
                }
            });
        };

        var oldItemByID = function(id) {
            for (var i = 0; i &lt; realDataList.length; i++) {
                if (realDataList[i].virtual_transport.id == id) {
                    return realDataList[i].virtual_transport;
                }
            }
        };

        return {
            /**
             * creates an new transport
             *
             * @method create
             * @param transport {Object} the transport object
             */
            create: function(transport) {
                var dao = Restangular.all(&#x27;transports&#x27;);
                dao.post(transport).then(function(response) {
                    var msg = &quot;New transport created: &quot;+transport.name;
                    AlertService.addAlert(&quot;success&quot;,msg);
                    refresh();
                }, function(response) {
                    var msg = &quot;There was an error saving the transport &quot;+transport.name+&quot;: \n&quot;+errorMsg(response.data.error);
                    AlertService.addAlert(&quot;danger&quot;,msg);
                });
            },
            /**
             * edit a existing tranpsort
             *
             * @method edit
             * @param transport {Object} the transport object
             */
            edit: function(transport) {
                var oldItem = oldItemByID(transport.id);
                var dao = Restangular.one(&#x27;transports&#x27;,oldItem.name);
                dao.name = transport.name;
                dao.destination = transport.destination;
                dao.put().then(function(response) {
                    var msg = &quot;Transport &quot;+transport.name+&quot; updated!&quot;;
                    AlertService.addAlert(&quot;success&quot;,msg);
                    refresh();
                }, function(response) {
                    var msg = &quot;There was an error updating the transport &quot;+transport.name+&quot;: \n&quot;+errorMsg(response.data.error);
                    AlertService.addAlert(&quot;danger&quot;,msg);
                    refresh();
                });
            },
            /**
             * remove an existing transport
             *
             * @method remove
             * @param alias {Object} the alias object
             */
            remove: function(transport) {
                var dao = Restangular.one(&#x27;transports&#x27;, transport.name);
                dao.remove().then(function(response) {
                    var msg = &quot;Transport &quot;+transport.name+&quot; deleted!&quot;;
                    AlertService.addAlert(&quot;success&quot;,msg);
                    refresh();
                }, function(response) {
                    var msg = &quot;There was an error deleting the transport &quot;+transport.name+&quot;: \n&quot;+errorMsg(response.data.error);
                    AlertService.addAlert(&quot;danger&quot;,msg);
                });
            },
            /**
             * get the list of all transports
             *
             * @method getList
             * @return {Array} Returns the aliasList-member
             */
            getList: function() {
                return list;
            },
            /**
             * refreshes the list
             *
             * @method refresh
             */
            refresh: function() {
                refresh();
            }
        };
    }]);

    /**
     * central Transport-model. Here you do all the CRUD-operations with the REST-API
     *
     * @class Transports
     */
    app.factory(&#x27;Users&#x27;, [&#x27;Restangular&#x27;, &#x27;AlertService&#x27;, &#x27;Domains&#x27;, function(Restangular, AlertService, Domains) {
        var list = [];	// list of all users
        var realDataList = []; // list of all data before it is edited
        var domain = null;

        var refresh = function() {
            list = [];
            realDataList = [];
            if (Domains.isValid(domain)) {            
                Restangular.one(&#x27;domains&#x27;,domain.name).all(&#x27;users&#x27;).getList().then(function(data) {
                    for (var i = 0; i &lt; data.length; i++) {
                        realDataList.push(angular.copy(data[i]));
                        list.push(data[i].virtual_user);
                    }
                });
            }
        };

        var oldItemByID = function(id) {
            for (var i = 0; i &lt; realDataList.length; i++) {
                if (realDataList[i].virtual_user.id == id) {
                    return realDataList[i].virtual_user;
                }
            }
        };

        return {
			/**
			* returns if the user is valid or not
			*
			* @method isValid
			* @param user {Object} the user
			* @return {Boolean} Returns true if the user is valid	
			*/			
			isValid: function(user) {
				return (user != null);			
			},        	
            /**
             * set the domain
             *
             * @method setDomain
             * @param newDomain {Object} the domain object
             */
            setDomain: function(newDomain) {
                if (domain != newDomain) {
                    domain = newDomain;
                }
            },
            /**
             * get the domain
             *
             * @method getDomain
             */
            getDomain: function () {
                return domain;
            },
            /**
             * creates an new user
             *
             * @method create
             * @param user {Object} the user object
             */
            create: function(user) {
                var dao = Restangular.one(&#x27;domains&#x27;,domain.name).all(&#x27;users&#x27;);
                dao.post(user).then(function(response) {
                    var msg = &quot;New user created: &quot;+user.name;
                    AlertService.addAlert(&quot;success&quot;,msg);
                    refresh();
                }, function(response) {
                    var msg = &quot;There was an error saving the user &quot;+user.name+&quot;: \n&quot;+errorMsg(response.data.error);
                    AlertService.addAlert(&quot;danger&quot;,msg);
                });
            },
            /**
             * edit a existing user
             *
             * @method edit
             * @param user {Object} the user object
             */
            edit: function(user) {
                var oldItem = oldItemByID(user.id);
                var dao = Restangular.one(&#x27;domains&#x27;,domain.name).one(&#x27;users&#x27;,oldItem.name);
                dao.name = user.name;
                dao.quota = user.quota;
                if (user.password != dao.password)
                    dao.password = user.password;
                dao.put().then(function(response) {
                    var msg = &quot;User &quot;+user.name+&quot; updated!&quot;;
                    AlertService.addAlert(&quot;success&quot;,msg);
                    refresh();
                }, function(response) {
                    var msg = &quot;There was an error updating the user &quot;+user.name+&quot;: \n&quot;+errorMsg(response.data.error);
                    AlertService.addAlert(&quot;danger&quot;,msg);
                    refresh();
                });
            },
            /**
             * remove an existing user
             *
             * @method remove
             * @param alias {Object} the user object
             */
            remove: function(user) {
                var dao = Restangular.one(&#x27;domains&#x27;,domain.name).one(&#x27;users&#x27;,user.name);
                dao.remove().then(function(response) {
                    var msg = &quot;User &quot;+user.name+&quot; deleted!&quot;;
                    AlertService.addAlert(&quot;success&quot;,msg);
                    refresh();
                }, function(response) {
                    var msg = &quot;There was an error deleting the user &quot;+user.name+&quot;: \n&quot;+errorMsg(response.data.error);
                    AlertService.addAlert(&quot;danger&quot;,msg);
                });
            },
            /**
             * get the list of all userers
             *
             * @method getList
             * @return {Array} Returns the aliasList-member
             */
            getList: function() {
                return list;
            },
            /**
             * refreshes the list
             *
             * @method refresh
             */
            refresh: function() {
                refresh();
            }
        };
    }]);

	/**
	* central UserAliasses-model. Here you do all the CRUD-operations with the REST-API
	*
	* @class UserAliasses
	*/
	app.factory(&#x27;UserAliasses&#x27;, [&#x27;Restangular&#x27;, &#x27;AlertService&#x27;, &#x27;Domains&#x27;, &#x27;Users&#x27;, function(Restangular, AlertService, Domains, Users) {
		var list = [];	// list of all aliases
		var domain = null;	
		var user = null;
		
		var refresh = function() {
			list = [];	
			if (Domains.isValid(domain) &amp;&amp; Users.isValid(user)) { 
				Restangular.one(&#x27;domains&#x27;,domain.name).one(&#x27;users&#x27;,user.name).all(&#x27;aliases&#x27;).getList().then(function(data) {									 	
				 	for (var i = 0; i &lt; data.length; i++) {				 					 		
				 		list.push(data[i].virtual_user_alias);				 						 						 				 		
				 	}					 																		
				});				
			}			
		};	

		return {
            /**
             * set the domain
             *
             * @method setDomain
             * @param newDomain {Object} the domain object
             */
            setDomain: function(newDomain) {
				if (domain != newDomain) {
					domain = newDomain;
				}
			},
            /**
             * get the domain
             *
             * @method getDomain
             */
			getDomain: function () {
				return domain;
			},
            /**
             * set the user
             *
             * @method setUser
             * @param newUser {Object} the user object
             */
            setUser: function(newUser) {
				if (user != newUser) {
					user = newUser;
				}
			},
            /**
             * get the user
             *
             * @method getUser
             */
			getUser: function () {
				return user;
			},			
			/**
			* creates an new user-alias
			*
			* @method create
			* @param alias {Object} the alias object			
			*/			
			create: function(alias) {						
				var dao = Restangular.one(&#x27;domains&#x27;,domain.name).one(&#x27;users&#x27;,user.name).all(&#x27;aliases&#x27;);
				dao.post(alias).then(function(response) {	
					var msg = &quot;New user alias created: &quot;+alias.name;
					AlertService.addAlert(&quot;success&quot;,msg);
					refresh();
				}, function(response) {	
					var msg = &quot;There was an error saving the user alias &quot;+alias.name+&quot;: \n&quot;+errorMsg(response.data.error);
					AlertService.addAlert(&quot;danger&quot;,msg); 						
				});							
			},
			/**
			* remove an existing alias
			*
			* @method remove
			* @param alias {Object} the alias object			
			*/
			remove: function(alias) {																	
				var dao = Restangular.one(&#x27;domains&#x27;,domain.name).one(&#x27;users&#x27;,user.name).one(&#x27;aliases&#x27;, alias.name);
				dao.remove().then(function(response) {							
					var msg = &quot;User alias &quot;+alias.name+&quot; deleted!&quot;;
					AlertService.addAlert(&quot;success&quot;,msg);					
					refresh();
				}, function(response) {
					var msg = &quot;There was an error deleting the user alias &quot;+alias.name+&quot;: \n&quot;+errorMsg(response.data.error);
					AlertService.addAlert(&quot;danger&quot;,msg);					
				});		
			},
			/**
			* get the list of all aliases		
			*
			* @method getList		
			* @return {Array} Returns the list-member
			*/
			getList: function() {		
				return list;	
			},
			/**
			* refreshes the list
			*
			* @method refresh
			*/				
			refresh: function() {			
				refresh();
			}
		};
	}]);

	/**
	* central Summaries-model. Here you do all the CRUD-operations with the REST-API
	*
	* @class Summaries
	*/
	app.factory(&#x27;Summaries&#x27;, [&#x27;Restangular&#x27;, function(Restangular) {
		var list = [];
		
		var refresh = function() {			
			list = [];		
			Restangular.all(&#x27;summary&#x27;).getList().then(function(items) {	
				angular.forEach(items, function(item){
				 	var data = new Object;
				 	data.value = item.count;
					data.percent = item.count;
				 	data.name = item.name;
				 	data.caption = item.name+&quot;: &quot;+item.count.toFixed(0);
					list.push(data);					
				});	 			 						
			});			
		};	

		return {
			/**
			* get the list of all summary-entries		
			*
			* @method getList		
			* @return {Array} Returns the list-member
			*/
			getList: function() {		
				return list;	
			},
			/**
			* refreshes the list
			*
			* @method refresh
			*/				
			refresh: function() {			
				refresh();
			}
		};
	}]);

    /**
     * central ApiKeys-model. Here you do all the CRUD-operations with the REST-API
     *
     * @class ApiKeys
     */
    app.factory(&#x27;ApiKeys&#x27;, [&#x27;Restangular&#x27;, &#x27;AlertService&#x27;, function(Restangular, AlertService) {
        var list = [];	// list of all api-keys
        var realDataList = []; // list of all data before it is edited

        var refresh = function() {
            list = [];
            realDataList = [];
            Restangular.all(&#x27;api_keys&#x27;).getList().then(function(data) {
                for (var i = 0; i &lt; data.length; i++) {
                    realDataList.push(angular.copy(data[i]));
                    list.push(data[i].api_key);
                }
            });
        };

        var oldItemByID = function(id) {
            for (var i = 0; i &lt; realDataList.length; i++) {
                if (realDataList[i].api_key.id == id) {
                    return realDataList[i].api_key;
                }
            }
        };

        return {
            /**
             * creates an new api-key
             *
             * @method create
             * @param apiKey {Object} the api-key object
             */
            create: function(apiKey) {
                var dao = Restangular.all(&#x27;api_keys&#x27;);
                dao.post(apiKey).then(function(response) {
                    var msg = &quot;New api-key created: &quot;+response.apiKey.access_token;
                    AlertService.addAlert(&quot;success&quot;,msg);
                    refresh();
                }, function(response) {
                    var msg = &quot;There was an error saving the api-key &quot;+response.apiKey.access_token+&quot;: \n&quot;+errorMsg(response.data.error);
                    AlertService.addAlert(&quot;danger&quot;,msg);
                });
            },
            /**
             * edit a existing api-key
             *
             * @method edit
             * @param apiKey {Object} the api-key object
             */
            edit: function(apiKey) {
                var dao = Restangular.one(&#x27;api_keys&#x27;,apiKey.access_token);
				dao.expires_at = apiKey.expires_at;		
				dao.active =  Number(apiKey.active);
                dao.put().then(function(response) {
                    var msg = &quot;Api-key &quot;+apiKey.access_token+&quot; updated!&quot;;
                    AlertService.addAlert(&quot;success&quot;,msg);
                    refresh();
                }, function(response) {
                    var msg = &quot;There was an error updating the api-key &quot;+apiKey.access_token+&quot;: \n&quot;+errorMsg(response.data.error);
                    AlertService.addAlert(&quot;danger&quot;,msg);
                    refresh();
                });
            },
            /**
             * remove an existing api-key
             *
             * @method remove
             * @param apiKey {Object} the api-key object
             */
            remove: function(apiKey) {
                var dao = Restangular.one(&#x27;api_keys&#x27;, apiKey.access_token);
                dao.remove().then(function(response) {
                    var msg = &quot;Api-key &quot;+apiKey.access_token+&quot; deleted!&quot;;
                    AlertService.addAlert(&quot;success&quot;,msg);
                    refresh();
                }, function(response) {
                    var msg = &quot;There was an error deleting the api-key &quot;+apiKey.access_token+&quot;: \n&quot;+errorMsg(response.data.error);
                    AlertService.addAlert(&quot;danger&quot;,msg);
                });
            },
            /**
             * get the list of all api-keys
             *
             * @method getList
             * @return {Array} Returns list-member
             */
            getList: function() {
                return list;
            },
            /**
             * refreshes the list
             *
             * @method refresh
             */
            refresh: function() {
                refresh();
            },
            /**
             * check if the api-key is expired
             *
             * @method isExpired
             * @param apiKey {Object} the api-key object
             */
            isExpired: function(apiKey) {
            	var today = new Date();
            	var date = new Date(apiKey.expires_at);	
            	return date-today&lt;0;
            }
        };
    }]);	

});
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
